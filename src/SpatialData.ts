
// this is "filled" by the extract-spatial-data.ts script
const RAW_SPATIAL_DATA = [{"name":"TEAM_1_HQ","AltTeam":"TeamNeutral","VehicleSpawnersEnabled":true,"ObjId":1,"InfantrySpawns":["TEAM_1_HQ/SpawnPoint_1_1","TEAM_1_HQ/SpawnPoint_1_2","TEAM_1_HQ/SpawnPoint_1_3","TEAM_1_HQ/SpawnPoint_1_4","TEAM_1_HQ/SpawnPoint_1_6","TEAM_1_HQ/SpawnPoint_1_5"],"HQArea":"TEAM_1_HQ/HQ_Team1","type":"HQ_PlayerSpawner","right":{"x":1,"y":0,"z":0},"up":{"x":0,"y":1,"z":0},"front":{"x":0,"y":0,"z":1},"position":{"x":-225.773,"y":88.623,"z":-392.224},"id":"TEAM_1_HQ","linked":["HQArea","InfantrySpawns"]},{"name":"TEAM_2_HQ","Team":"Team2","AltTeam":"TeamNeutral","VehicleSpawnersEnabled":true,"ObjId":2,"InfantrySpawns":["TEAM_2_HQ/SpawnPoint_1_1","TEAM_2_HQ/SpawnPoint_1_2","TEAM_2_HQ/SpawnPoint_1_3","TEAM_2_HQ/SpawnPoint_1_4","TEAM_2_HQ/SpawnPoint_1_5","TEAM_2_HQ/SpawnPoint_1_6"],"HQArea":"TEAM_2_HQ/HQ_Team2","type":"HQ_PlayerSpawner","right":{"x":1,"y":0,"z":0},"up":{"x":0,"y":1,"z":0},"front":{"x":0,"y":0,"z":1},"position":{"x":259.6,"y":88.054,"z":-293.947},"id":"TEAM_2_HQ","linked":["HQArea","InfantrySpawns"]},{"name":"AI_Spawner","ObjId":11001,"type":"AI_Spawner","right":{"x":0.079329177672,"y":0,"z":0.996848756138},"up":{"x":0,"y":1,"z":0},"front":{"x":-0.996848756138,"y":0,"z":0.079329177672},"position":{"x":-284.3164331097,"y":85.75594,"z":-268.7736115151},"id":"Ai Vehicles/AI_Spawner"},{"name":"AI_Spawner","ObjId":11002,"type":"AI_Spawner","right":{"x":0.079329177672,"y":0,"z":0.996848756138},"up":{"x":0,"y":1,"z":0},"front":{"x":-0.996848756138,"y":0,"z":0.079329177672},"position":{"x":-284.45039867191,"y":85.75594,"z":-270.4570199150529},"id":"Ai Vehicles/AI_Spawner/AI_Spawner"},{"name":"AI_Spawner2","ObjId":11003,"type":"AI_Spawner","right":{"x":0.079329177672,"y":0,"z":0.996848756138},"up":{"x":0,"y":1,"z":0},"front":{"x":-0.996848756138,"y":0,"z":0.079329177672},"position":{"x":-284.1666731082155,"y":85.75594,"z":-266.8917305278},"id":"Ai Vehicles/AI_Spawner/AI_Spawner2"},{"name":"AI_Spawner3","ObjId":11004,"type":"AI_Spawner","right":{"x":0.079329177672,"y":0,"z":0.996848756138},"up":{"x":0,"y":1,"z":0},"front":{"x":-0.996848756138,"y":0,"z":0.079329177672},"position":{"x":-284.03310814349845,"y":85.75594,"z":-265.2133562152477},"id":"Ai Vehicles/AI_Spawner/AI_Spawner3"},{"name":"Abrams","ObjId":12001,"P_AutoSpawnEnabled":true,"P_DefaultRespawnTime":10,"P_ApplyDamageToAbandonVehicle":false,"P_AbandonVehiclesOutOfCombatArea":false,"type":"VehicleSpawner","right":{"x":0.995637405126,"y":0,"z":-0.093309155906},"up":{"x":0,"y":1,"z":0},"front":{"x":0.093309155906,"y":0,"z":0.995637405126},"position":{"x":-353.9096153747,"y":86.411607,"z":-207.5729839263},"id":"Ai Vehicles/Spawners/Abrams"},{"name":"Guepard","ObjId":12002,"VehicleType":"Gepard","P_AutoSpawnEnabled":true,"P_DefaultRespawnTime":10,"P_ApplyDamageToAbandonVehicle":false,"P_AbandonVehiclesOutOfCombatArea":false,"type":"VehicleSpawner","right":{"x":-0.040201236337,"y":0,"z":-0.999192931745},"up":{"x":0,"y":1,"z":0},"front":{"x":0.999192931745,"y":0,"z":-0.040201236337},"position":{"x":-379.1184314346,"y":88.41364,"z":-280.8814624474},"id":"Ai Vehicles/Spawners/Guepard"},{"name":"CV90","ObjId":12003,"VehicleType":"CV90","P_AutoSpawnEnabled":true,"P_DefaultRespawnTime":10,"P_ApplyDamageToAbandonVehicle":false,"P_AbandonVehiclesOutOfCombatArea":false,"type":"VehicleSpawner","right":{"x":0.028497717988,"y":0,"z":-0.999594340412},"up":{"x":0,"y":1,"z":0},"front":{"x":0.999594340412,"y":0,"z":0.028497717988},"position":{"x":-424.4480217789,"y":84.61416,"z":-256.8747090121},"id":"Ai Vehicles/Spawners/CV90"},{"name":"Vector","ObjId":12004,"VehicleType":"Vector","P_AutoSpawnEnabled":true,"P_DefaultRespawnTime":10,"P_ApplyDamageToAbandonVehicle":false,"P_AbandonVehiclesOutOfCombatArea":false,"type":"VehicleSpawner","right":{"x":-0.177771688955,"y":0,"z":-0.984072003295},"up":{"x":0,"y":1,"z":0},"front":{"x":0.984072003295,"y":0,"z":-0.177771688955},"position":{"x":-410.0613959103,"y":85.41791,"z":-170.0576590067},"id":"Ai Vehicles/Spawners/Vector"},{"name":"AH64","ObjId":12005,"VehicleType":"AH64","P_AutoSpawnEnabled":true,"P_DefaultRespawnTime":10,"P_ApplyDamageToAbandonVehicle":false,"P_AbandonVehiclesOutOfCombatArea":false,"type":"VehicleSpawner","right":{"x":0.991967246291,"y":0,"z":0.126493483865},"up":{"x":0,"y":1,"z":0},"front":{"x":-0.126493483865,"y":0,"z":0.991967246291},"position":{"x":-399.2150776195,"y":90.40846,"z":-320.6080142135},"id":"Ai Vehicles/Spawners/AH64"},{"name":"Eurocopter","ObjId":12006,"VehicleType":"Eurocopter","P_AutoSpawnEnabled":true,"P_DefaultRespawnTime":10,"P_ApplyDamageToAbandonVehicle":false,"P_AbandonVehiclesOutOfCombatArea":false,"type":"VehicleSpawner","right":{"x":0.37601374825,"y":0,"z":0.926614579042},"up":{"x":0,"y":1,"z":0},"front":{"x":-0.926614579042,"y":0,"z":0.37601374825},"position":{"x":-364.83279578,"y":86.024523,"z":-70.463241498},"id":"Ai Vehicles/Spawners/Eurocopter"},{"name":"Leopard","ObjId":12007,"VehicleType":"Leopard","P_AutoSpawnEnabled":true,"P_DefaultRespawnTime":10,"P_ApplyDamageToAbandonVehicle":false,"P_AbandonVehiclesOutOfCombatArea":false,"type":"VehicleSpawner","right":{"x":-0.650774569842,"y":0,"z":0.759271587412},"up":{"x":0,"y":1,"z":0},"front":{"x":-0.759271587412,"y":0,"z":-0.650774569842},"position":{"x":-384.1171283888,"y":88.09637,"z":-130.8752966232},"id":"Ai Vehicles/Spawners/Leopard"},{"name":"bradley","ObjId":12008,"VehicleType":"M2Bradley","P_AutoSpawnEnabled":true,"P_DefaultRespawnTime":10,"P_ApplyDamageToAbandonVehicle":false,"P_AbandonVehiclesOutOfCombatArea":false,"type":"VehicleSpawner","right":{"x":-0.799978313052,"y":0,"z":-0.60002991379},"up":{"x":0,"y":1,"z":0},"front":{"x":0.60002991379,"y":0,"z":-0.799978313052},"position":{"x":-476.40332102439,"y":86.095521,"z":-187.95794128871},"id":"Ai Vehicles/Spawners/bradley"},{"name":"Marauder","ObjId":12009,"VehicleType":"Marauder_Pax","P_AutoSpawnEnabled":true,"P_DefaultRespawnTime":10,"P_ApplyDamageToAbandonVehicle":false,"P_AbandonVehiclesOutOfCombatArea":false,"type":"VehicleSpawner","right":{"x":-0.033748600978,"y":0,"z":0.999430805642},"up":{"x":0,"y":1,"z":0},"front":{"x":-0.999430805642,"y":0,"z":-0.033748600978},"position":{"x":-328.305212613246,"y":86.691697,"z":-242.843991566694},"id":"Ai Vehicles/Spawners/Marauder"},{"name":"uh60","ObjId":12010,"VehicleType":"UH60","P_AutoSpawnEnabled":true,"P_DefaultRespawnTime":10,"P_ApplyDamageToAbandonVehicle":false,"P_AbandonVehiclesOutOfCombatArea":false,"type":"VehicleSpawner","right":{"x":-0.04159582281,"y":0,"z":-0.999134496444},"up":{"x":0,"y":1,"z":0},"front":{"x":0.999134496444,"y":0,"z":-0.04159582281},"position":{"x":-518.440642614769,"y":87.453286,"z":-173.080861737441},"id":"Ai Vehicles/Spawners/uh60"},{"name":"AI_Spawner","ObjId":55101,"type":"AI_Spawner","right":{"x":-0.124086,"y":0,"z":-0.992271},"up":{"x":0,"y":1,"z":0},"front":{"x":0.992271,"y":0,"z":-0.124086},"position":{"x":-268.1866,"y":89.93009,"z":-439.3512},"id":"MovingVehicle/AI_Spawner"}];
// END RAW_SPATIAL_DATA


class SpatialData
{
    public static objectsPerId: Map<number, SpatialObject>;
    public static objectsPerHierarchy: Map<string, SpatialObject>;
    public static objectsPerName: Map<string, SpatialObject>; // note that the name may be not unique

    public static init(): void
    {
        for (const object of RAW_SPATIAL_DATA) {
            const type = object.type;

            let objectFqcn: string = 'SpatialObject';
            switch (type) {
                case "VehicleSpawner": objectFqcn = 'VehicleSpawner'; break;
            }

            const objectType = {
                SpatialObject, VehicleSpawner,
            }[objectFqcn];
            if (objectType === undefined) {
                continue;
            }

            const instance = new objectType(
                object.ObjId, // Object id as defined in Godot
                object.name, // last part of the Godot object hierarchy. Ie: "VehicleSpawner5"
                object.id, // Godot object hierarchy. ie: "TankRange/Start/VehicleSpawner5"
                mod.Types[object.type], // object.type is the name of the object as found in Godot's asset library. Ie: "VehicleSpawner"
                mod.CreateVector(object.position.x, object.position.y, object.position.z),
                object,
            );

            this.objectsPerId.set(instance.id, instance);
            this.objectsPerHierarchy.set(instance.hierarchy, instance);
            this.objectsPerName.set(instance.name, instance);
        }
    }

    public static getByObjectId(objectId: number): SpatialObject|null
    {
        return this.objectsPerId.get(objectId) ?? null;
    }

    public static getByHierarchy(name: string): SpatialObject|null
    {
        return this.objectsPerHierarchy.get(name) ?? null;
    }

    public static getByName(name: string): SpatialObject|null
    {
        return this.objectsPerName.get(name) ?? null;
    }
}

class SpatialObject
{
    constructor(
        public readonly id: number,
        public readonly name: string,
        public readonly hierarchy: string,
        public readonly type: mod.Types,
        public readonly position: mod.Vector,
        public readonly rawData: any, // this a JSON object, but its more practical to type is as any
    ) {
        this.initFromRawData();
    }

    protected initFromRawData(): void
    {
        // allow for child classes to define more properties with the raw data
        // without having to redeclare a constructor
    }
}

class VehicleSpawner extends SpatialObject
{
    public vehicleType: mod.VehicleList;

    protected initFromRawData(): void
    {
        this.vehicleType = mod.VehicleList[this.rawData.VehicleType];
    }

    public getObject(): mod.VehicleSpawner|null
    {
        return mod.GetVehicleSpawner(this.id) ?? null;
    }
}
